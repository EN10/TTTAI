<!DOCTYPE html>
<html>
<body>
<h1>Tic Tac Toe</h1>
<canvas id="draw"></canvas>
<script>
document.getElementById('draw').width = 300;
document.getElementById('draw').height = 300;
document.getElementById('draw').addEventListener('click', ClickXY);

var xhr=new XMLHttpRequest();                   // Load Games.txt
xhr.onreadystatechange=function() { 
if (xhr.readyState==4 && xhr.status==200)
{ console.log(xhr.responseText); }
};
xhr.open("GET","games.txt",true);               // GET is simpler and faster than POST
xhr.send();

var g = document.getElementById("draw").getContext("2d");
g.fillRect(0,0,100,100);                        // Draw 
g.fillRect(200,0,100,100);
g.fillRect(100,100,100,100);
g.fillRect(0,200,100,100);
g.fillRect(200,200,100,100);

function ClickXY(event) {                       // Mouse ClickXY
g.fillStyle="red";
g.font="80px Arial";
g.fillText("O",event.clientX-35,event.clientY-50);
XYtoSQ(event.clientX,event.clientY);
}

var w=100; var h=100; var sq;  
function  XYtoSQ(x,y) {                         // Convert MouseXY to a SQ
     if     (x < 10)        { sq=0; }           // Canvas starts 10 pixels on x
else if     (x < 10+w)      { sq=1; }
else if     (x < 10+2*w)    { sq=2; }
else if     (x < 10+3*w)    { sq=3; }
else                        { sq=0; }
if          (y < 60)        { sq=0; }           // Canvas starts 60 pixels on y
else if     (y < 60+h)      {       }
else if     (y < 60+2*h)    { sq+=3;}
else if     (y < 60+3*h)    { sq+=6;}
else                        { sq= 0;}
grid[sq] = 'O';     count+=1;   win();          // Store Game
if (count < 9) outputX();                       // Empty Sq ?
}

function outputX() {                            // Draw X
var i=w/3-10; var j=h*2/3+10;                   // Offset Sq Center
do  {   random();   }
while (grid[r] !== undefined);                  // Generate X in Empty Sq

if (r == 1) g.fillText("X",i,j);
if (r == 2) g.fillText("X",i+w,j);
if (r == 3) g.fillText("X",i+2*w,j);
if (r == 4) g.fillText("X",i,j+h);
if (r == 5) g.fillText("X",i+w,j+h);
if (r == 6) g.fillText("X",i+2*w,j+h);
if (r == 7) g.fillText("X",i,j+2*h);
if (r == 8) g.fillText("X",i+w,j+2*h);
if (r == 9) g.fillText("X",i+2*w,j+2*h);

grid[r] = 'X';  count+=1;   displayGrid();
}

var r;
function random() {
r = Math.floor(Math.random()*8)+1;              // Number from 1-9
//console.log('r: '.concat(r));                 // Debug random X sq
}

var grid = [];  var count = 0;
function displayGrid(){                         // Outputs the Grid
    var line = '';
    for (var i=1; i<=9; i++)
    {   if (grid[i] === undefined)   
        {   line += '-' }
        else
        {   line += grid[i];    }
        
        if (i % 3 === 0)
        {   console.log(line);
            line = '';
        }
    }
}

function win() {                                // Test Win Conditons   if x lose
    for (var i=1; i<=9; i+=3)             
    {   if (grid[i] == 'O' && grid[i] === grid[i+1] && grid[i+1] === grid[i+2])
        {   console.log("You WIN!"); }          // Horizontal
    }
    for (var j=1; j<=3; j++) 
    {   if (grid[j] == 'O' && grid[j] === grid[j+3] && grid[j+3] === grid[j+6])
        {   console.log("You WIN!"); }           // Vertical
    }
        if (grid[1] == 'O' && grid[1] === grid[5] && grid[5] === grid[9])
        {   console.log("You WIN!"); }           // Main Diagonal
        if (grid[3] == 'O' && grid[3] === grid[5] && grid[5] === grid[7])
        {   console.log("You WIN!"); }           // Anti-Diagonal
    
}
</script>
<p>By Enio Fernandes</p>
</body>
</html>