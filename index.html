<!DOCTYPE html>
<html>
<body>
<h1>Tic Tac Toe</h1>
<canvas id="draw"></canvas>
<script>
document.getElementById('draw').width = 300;
document.getElementById('draw').height = 300;
document.getElementById('draw').addEventListener('click', ClickXY);

var xhr=new XMLHttpRequest();                   // Load Games.txt
xhr.onreadystatechange=function() { 
if (xhr.readyState==4 && xhr.status==200)
{ console.log(xhr.responseText); }
};
xhr.open("GET","games.txt",true);               // GET is simpler and faster than POST
xhr.send();

var g = document.getElementById("draw").getContext("2d");
g.fillRect(0,0,100,100);                        // Draw Grid
g.fillRect(200,0,100,100);
g.fillRect(100,100,100,100);
g.fillRect(0,200,100,100);
g.fillRect(200,200,100,100);

function ClickXY(event) {                       // Mouse ClickXY
g.fillStyle="red";
g.font="80px Arial";
g.fillText("O",event.clientX-35,event.clientY-50);
XYtoSQ(event.clientX,event.clientY);
}

var w=100; var h=100; var sq; var game=''; var r;
function  XYtoSQ(x,y) {                         // Convert MouseXY to a SQ
     if     (x < 10)        { sq=0; }           // Canvas starts 10 pixels on x
else if     (x < 10+w)      { sq=1; }
else if     (x < 10+2*w)    { sq=2; }
else if     (x < 10+3*w)    { sq=3; }
else                        { sq=0; }
if          (y < 60)        { sq=0; }           // Canvas starts 60 pixels on y
else if     (y < 60+h)      {       }
else if     (y < 60+2*h)    { sq+=3;}
else if     (y < 60+3*h)    { sq+=6;}
else                        { sq= 0;}
game+="O"+sq;  console.log('O: '.concat(sq));   // Store Game
win();
}

function outputX() {                            // Draw X
var i=w/3-10; var j=h*2/3+10;                   // Offset Sq Center
do  { random(); }
while (game.search(r) != -1);                   // Generate X in Empty Sq

if (r == 1) g.fillText("X",i,j);
if (r == 2) g.fillText("X",i+w,j);
if (r == 3) g.fillText("X",i+2*w,j);
if (r == 4) g.fillText("X",i,j+h);
if (r == 5) g.fillText("X",i+w,j+h);
if (r == 6) g.fillText("X",i+2*w,j+h);
if (r == 7) g.fillText("X",i,j+2*h);
if (r == 8) g.fillText("X",i+w,j+2*h);
if (r == 9) g.fillText("X",i+2*w,j+2*h);
game+="X"+r;
console.log(game.toString());
}

function random() {
r = Math.floor(Math.random()*8)+1;              // Number from 1-9
//console.log('r: '.concat(r));                 // Debug random X sq
}

function win() {                                // Test Win Conditons
var PO = []; 
for (var i=0; i<game.length; i++)               // Remove and Sort "O" Cells
{   if (game[i] == "O") PO[i] = game[i+1];  }
PO=PO.sort();   console.log(PO.toString());

    for (var j=0; j<PO.length; j++)             
    {   if (PO[j]+1 === PO[j+1] && PO[j+1]+1 === PO[j+2] && PO[j+2] % 3 === 0)  
        {   console.log("You WIN!"); }           // Horizontal
        if (PO[j] === PO[j+3] && PO[j+3] === PO[j+6] && PO[j] !== undefined)  
        {   console.log("You WIN!"); }           // Vertical
    }
        if (PO.indexOf(1) != -1 && PO.indexOf(5) != -1 && PO.indexOf(9) != -1)
        {   console.log("You WIN!"); }           // Main Diagonal
        if (PO.indexOf(3) != -1 && PO.indexOf(5) != -1 && PO.indexOf(7) != -1)
        {   console.log("You WIN!"); }           // Anti-Diagonal
        if (game.length < 16) outputX();         // Empty Sq ?
}
</script>
<p>By Enio Fernandes</p>
</body>
</html>